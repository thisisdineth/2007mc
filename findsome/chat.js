const _0x15bcb5=_0x1ce5;(function(_0x18c90b,_0x1815a0){const _0x5e13c4=_0x1ce5,_0x2509d8=_0x18c90b();while(!![]){try{const _0x359d26=parseInt(_0x5e13c4(0xc7))/0x1*(parseInt(_0x5e13c4(0xe0))/0x2)+-parseInt(_0x5e13c4(0xcf))/0x3+parseInt(_0x5e13c4(0xbe))/0x4+-parseInt(_0x5e13c4(0xb5))/0x5*(parseInt(_0x5e13c4(0xb9))/0x6)+parseInt(_0x5e13c4(0xd5))/0x7*(-parseInt(_0x5e13c4(0xde))/0x8)+-parseInt(_0x5e13c4(0xd1))/0x9+parseInt(_0x5e13c4(0xb6))/0xa;if(_0x359d26===_0x1815a0)break;else _0x2509d8['push'](_0x2509d8['shift']());}catch(_0x46be5b){_0x2509d8['push'](_0x2509d8['shift']());}}}(_0x3b6d,0xdaf28));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged}from'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';import{getDatabase,ref,set,get,push,onValue,remove,serverTimestamp,onDisconnect}from'https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js';import{filterBadWords}from'./badword.js';const firebaseConfig={'apiKey':'AIzaSyBTonYWFHgcxcVi1BBVeZkx823CfuT7CgM','authDomain':'findaguest-3024b.firebaseapp.com','databaseURL':_0x15bcb5(0xa6),'projectId':'findaguest-3024b','storageBucket':_0x15bcb5(0xa7),'messagingSenderId':_0x15bcb5(0xe1),'appId':_0x15bcb5(0xaf),'measurementId':_0x15bcb5(0xbd)},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getDatabase(app);let currentUser=null,currentChatRoom=null,typingRef=null,replyMessageId=null,inactivityTimeout=null,chatLeaveTimeout=null;signInAnonymously(auth)[_0x15bcb5(0xb0)](_0x307640=>{const _0x4505d6=_0x15bcb5;console[_0x4505d6(0xad)](_0x4505d6(0xe7),_0x307640);}),window[_0x15bcb5(0xdb)](_0x15bcb5(0xb2),function(){setTimeout(function(){const _0x58d806=_0x1ce5;document['body'][_0x58d806(0xc5)][_0x58d806(0xb8)]('loaded');},0x3e8);}),onAuthStateChanged(auth,_0x38aec6=>{const _0x465d11=_0x15bcb5;if(_0x38aec6){currentUser=_0x38aec6,updateUserStatus(_0x465d11(0xda)),setActiveUser(),updateActiveUsersCount();const _0x21ba9c=ref(db,_0x465d11(0xc3)+currentUser[_0x465d11(0xc9)]+'/currentChatRoom');onValue(_0x21ba9c,_0xcef15=>{const _0x419c94=_0x465d11;_0xcef15[_0x419c94(0xa4)]()&&(currentChatRoom=_0xcef15['val'](),redirectToChatRoom(),listenForMessages(),listenForTyping(),resetInactivityTimer());});}});function updateUserStatus(_0x4b1e90){const _0x2d4501=_0x15bcb5,_0x2c836a=ref(db,_0x2d4501(0xb3)+currentUser[_0x2d4501(0xc9)]);set(_0x2c836a,{'uid':currentUser[_0x2d4501(0xc9)],'status':_0x4b1e90,'timestamp':serverTimestamp()});}function updateActiveUsersCount(){const _0x22933b=_0x15bcb5,_0x2270e5=ref(db,_0x22933b(0xbf));onValue(_0x2270e5,_0x24e9a4=>{const _0x3a054a=_0x22933b,_0x471846=_0x24e9a4['exists']()?Object['keys'](_0x24e9a4[_0x3a054a(0xbc)]())[_0x3a054a(0x9d)]:0x0;document[_0x3a054a(0xb1)]('active-user-count')[_0x3a054a(0xe4)]=_0x471846;});}function setActiveUser(){const _0x363697=_0x15bcb5,_0x252434=ref(db,_0x363697(0xb3)+currentUser[_0x363697(0xc9)]);set(_0x252434,{'uid':currentUser[_0x363697(0xc9)],'status':_0x363697(0xda),'timestamp':serverTimestamp()}),onDisconnect(_0x252434)['remove']()['then'](()=>{const _0x422ed6=_0x363697;console['log'](_0x422ed6(0xf4)),updateActiveUsersCount();}),document[_0x363697(0xdb)](_0x363697(0xae),handleVisibilityChange);}function handleVisibilityChange(){const _0x4fa13e=_0x15bcb5;document[_0x4fa13e(0xf1)]?markUserInactive():markUserActive();}function markUserInactive(){const _0x1ea2e6=_0x15bcb5;updateUserStatus(_0x1ea2e6(0xda)),clearTimeout(inactivityTimeout),clearTimeout(chatLeaveTimeout);}function markUserActive(){updateUserStatus('available'),resetInactivityTimer();}function _0x3b6d(){const _0x51d88e=['floor','<sup>','new-chat-btn','No\x20active\x20users\x20available.','none','error','visibilitychange','1:292838904473:web:65cc9227374cb898581e08','catch','getElementById','load','activeUsers/','toLocaleTimeString','301695NSBNAw','21076970MWfEUa','scrollTop','add','24DcavQV','style','you','val','G-WPJK68Y0XZ','5888412saPgqy','activeUsers','replyTo','includes','chatRooms/','users/','keys','classList','/status','699UqTnOx','div','uid','key','Stranger\x20is\x20typing...','block','log','/currentChatRoom','4405107tvLBaP','busy','8598618sFpcXH','message','trim','users','651TyxBVS','You:\x20Type\x20a\x20message...','replace','local-time','Replying\x20to:\x20','available','addEventListener','then','/messages','109288NCUhQB','chat-box','3584xLnzIQ','292838904473','chat-input','appendChild','textContent','message-text','innerHTML','Error\x20signing\x20in\x20anonymously:','chat-container','chatRooms','</sup>','preventDefault','skip-btn','keydown','createElement','The\x20user\x20has\x20left\x20the\x20chat.','filter','hidden','No\x20available\x20users\x20to\x20start\x20a\x20chat.\x20Please\x20wait...','You\x20have\x20left\x20the\x20chat.','User\x20disconnected.','scrollHeight','Enter','Error\x20sending\x20message:','stranger','length','click','status','reply','display','forEach','send-btn','exists','/typing/','https://findaguest-3024b-default-rtdb.asia-southeast1.firebasedatabase.app','findaguest-3024b.appspot.com'];_0x3b6d=function(){return _0x51d88e;};return _0x3b6d();}function resetInactivityTimer(){clearTimeout(chatLeaveTimeout),chatLeaveTimeout=setTimeout(leaveChatRoom,0x1d4c0);}async function startChat(){const _0x70c63a=_0x15bcb5;try{const _0x2b2425=ref(db,'activeUsers'),_0x478d14=await get(_0x2b2425);if(_0x478d14['exists']()){const _0x13fa98=_0x478d14['val'](),_0x271fe2=Object[_0x70c63a(0xc4)](_0x13fa98)[_0x70c63a(0xf0)](_0x513a6c=>_0x513a6c!==currentUser[_0x70c63a(0xc9)]&&_0x13fa98[_0x513a6c][_0x70c63a(0x9f)]===_0x70c63a(0xda));if(_0x271fe2[_0x70c63a(0x9d)]>0x0){const _0x3402e8=_0x271fe2[Math[_0x70c63a(0xa8)](Math['random']()*_0x271fe2['length'])];await connectToChatRoom(_0x3402e8);}else alert(_0x70c63a(0xf2));}else alert(_0x70c63a(0xab));}catch(_0x5b1567){console['error']('Error\x20starting\x20chat:',_0x5b1567);}}async function connectToChatRoom(_0x17927a){const _0x1379ed=_0x15bcb5;if(_0x17927a===currentUser[_0x1379ed(0xc9)]){console[_0x1379ed(0xad)]('Cannot\x20connect\x20to\x20a\x20chat\x20room\x20with\x20yourself.');return;}const _0x398a47=ref(db,_0x1379ed(0xe9)),_0x2641fe=ref(db,_0x1379ed(0xc3)+currentUser[_0x1379ed(0xc9)]+_0x1379ed(0xce)),_0x4db8f0=ref(db,_0x1379ed(0xc3)+_0x17927a+_0x1379ed(0xce));let _0x1f55ae=null;const _0x428032=await get(_0x398a47);_0x428032[_0x1379ed(0xa4)]()&&_0x428032['forEach'](_0x26529d=>{const _0x2e3418=_0x1379ed,_0x35e5a5=_0x26529d['val']();_0x35e5a5['users']&&_0x35e5a5[_0x2e3418(0xd4)][_0x2e3418(0xc1)](currentUser[_0x2e3418(0xc9)])&&_0x35e5a5[_0x2e3418(0xd4)][_0x2e3418(0xc1)](_0x17927a)&&(_0x1f55ae=_0x26529d[_0x2e3418(0xca)]);});if(_0x1f55ae)currentChatRoom=_0x1f55ae,await set(_0x2641fe,currentChatRoom),await set(_0x4db8f0,currentChatRoom);else{const _0xf974b8=push(_0x398a47);currentChatRoom=_0xf974b8[_0x1379ed(0xca)],await set(_0xf974b8,{'users':[currentUser[_0x1379ed(0xc9)],_0x17927a],'messages':[]}),await set(_0x2641fe,currentChatRoom),await set(_0x4db8f0,currentChatRoom);}updateUserStatus(_0x1379ed(0xd0)),await set(ref(db,_0x1379ed(0xb3)+_0x17927a+_0x1379ed(0xc6)),'busy'),console[_0x1379ed(0xcd)]('Connected\x20to\x20chat\x20room\x20with\x20ID:\x20'+currentChatRoom),redirectToChatRoom(),listenForMessages(),listenForTyping(),resetInactivityTimer();}function redirectToChatRoom(){const _0x295ad6=_0x15bcb5;alert('Successfully\x20connected\x20to\x20a\x20user!\x20You\x20can\x20now\x20start\x20chatting.'),document['getElementById'](_0x295ad6(0xe8))[_0x295ad6(0xba)][_0x295ad6(0xa1)]=_0x295ad6(0xcc);}function listenForMessages(){const _0x371e0d=_0x15bcb5;if(!currentChatRoom)return;const _0x5cf783=ref(db,_0x371e0d(0xc2)+currentChatRoom+'/messages');onValue(_0x5cf783,_0x4eac78=>{const _0x1f52d7=_0x371e0d,_0x540474=document['getElementById'](_0x1f52d7(0xdf));_0x540474['innerHTML']='',_0x4eac78[_0x1f52d7(0xa2)](_0x22e16f=>{const _0x3b9e67=_0x1f52d7,_0x29b730=_0x22e16f['val'](),_0x57a037=document[_0x3b9e67(0xee)]('div');_0x57a037[_0x3b9e67(0xc5)][_0x3b9e67(0xb8)]('message'),_0x57a037[_0x3b9e67(0xc5)][_0x3b9e67(0xb8)](_0x29b730[_0x3b9e67(0xc9)]===currentUser[_0x3b9e67(0xc9)]?_0x3b9e67(0xbb):_0x3b9e67(0x9c));const _0x58f9b7=document['createElement'](_0x3b9e67(0xc8));_0x58f9b7[_0x3b9e67(0xc5)][_0x3b9e67(0xb8)](_0x3b9e67(0xe5)),_0x58f9b7['innerHTML']=filterBadWords(formatMathExpression(_0x29b730[_0x3b9e67(0xd2)])),_0x57a037[_0x3b9e67(0xe3)](_0x58f9b7);if(_0x29b730[_0x3b9e67(0xc0)]){const _0x5b1bc0=document['createElement'](_0x3b9e67(0xc8));_0x5b1bc0[_0x3b9e67(0xc5)][_0x3b9e67(0xb8)](_0x3b9e67(0xa0)),_0x5b1bc0['innerHTML']=_0x3b9e67(0xd9)+filterBadWords(formatMathExpression(_0x29b730[_0x3b9e67(0xc0)][_0x3b9e67(0xd2)])),_0x57a037[_0x3b9e67(0xe3)](_0x5b1bc0);}_0x540474[_0x3b9e67(0xe3)](_0x57a037);}),_0x540474['scrollTop']=_0x540474[_0x1f52d7(0xf5)];});}function listenForTyping(){const _0xbb777e=_0x15bcb5;if(!currentChatRoom)return;typingRef=ref(db,_0xbb777e(0xc2)+currentChatRoom+'/typing'),onValue(typingRef,_0x3dad48=>{const _0x530594=_0xbb777e,_0x242794=_0x3dad48['val']();document[_0x530594(0xb1)]('typing-indicator')[_0x530594(0xe4)]=_0x242794&&_0x242794[_0x530594(0xc9)]!==currentUser['uid']?_0x530594(0xcb):'';});}function handleTyping(){const _0x13cd6f=_0x15bcb5;if(!currentChatRoom)return;const _0x1cc131=ref(db,'chatRooms/'+currentChatRoom+_0x13cd6f(0xa5)+currentUser['uid']);set(_0x1cc131,{'uid':currentUser[_0x13cd6f(0xc9)],'timestamp':serverTimestamp()}),resetInactivityTimer();}function _0x1ce5(_0x1b00e3,_0x570d46){const _0x3b6d56=_0x3b6d();return _0x1ce5=function(_0x1ce5a8,_0x3c571e){_0x1ce5a8=_0x1ce5a8-0x9b;let _0x33860b=_0x3b6d56[_0x1ce5a8];return _0x33860b;},_0x1ce5(_0x1b00e3,_0x570d46);}function sendMessage(){const _0x2a0e25=_0x15bcb5,_0x1f2ae1=document['getElementById'](_0x2a0e25(0xe2))['value'];if(_0x1f2ae1[_0x2a0e25(0xd3)]()==='')return;const _0x54ed7d=ref(db,_0x2a0e25(0xc2)+currentChatRoom+_0x2a0e25(0xdd)),_0x868691=push(_0x54ed7d);set(_0x868691,{'uid':currentUser[_0x2a0e25(0xc9)],'message':filterBadWords(formatMathExpression(_0x1f2ae1)),'replyTo':replyMessageId?{'message':replyMessageId}:null,'timestamp':serverTimestamp()})[_0x2a0e25(0xdc)](()=>{const _0x9dde64=_0x2a0e25;document[_0x9dde64(0xb1)](_0x9dde64(0xe2))['value']='',document[_0x9dde64(0xb1)](_0x9dde64(0xe2))['placeholder']=_0x9dde64(0xd6),replyMessageId=null,handleTyping();const _0x3d5430=document[_0x9dde64(0xb1)](_0x9dde64(0xdf));_0x3d5430[_0x9dde64(0xb7)]=_0x3d5430[_0x9dde64(0xf5)];})['catch'](_0x5d8982=>{const _0x968f89=_0x2a0e25;console[_0x968f89(0xad)](_0x968f89(0x9b),_0x5d8982);});}async function leaveChatRoom(){const _0x1e82af=_0x15bcb5;if(currentChatRoom){const _0x1d2390=ref(db,_0x1e82af(0xc2)+currentChatRoom),_0x230d92=push(ref(db,'chatRooms/'+currentChatRoom+_0x1e82af(0xdd)));await set(_0x230d92,{'uid':currentUser[_0x1e82af(0xc9)],'message':_0x1e82af(0xef),'isSystemMessage':!![],'timestamp':serverTimestamp()}),setTimeout(async()=>{const _0x2ebb95=_0x1e82af;await remove(_0x1d2390),currentChatRoom=null,document['getElementById']('chat-box')[_0x2ebb95(0xe6)]='',document[_0x2ebb95(0xb1)](_0x2ebb95(0xe8))['style']['display']=_0x2ebb95(0xac),alert(_0x2ebb95(0xf3)),updateUserStatus(_0x2ebb95(0xda));},0x1f4);}}function formatMathExpression(_0x470c6c){const _0x315d9b=_0x15bcb5;return _0x470c6c=_0x470c6c[_0x315d9b(0xd7)](/\^(\d+)/g,(_0x40951d,_0x35e1e5)=>_0x315d9b(0xa9)+_0x35e1e5+_0x315d9b(0xea)),_0x470c6c=_0x470c6c[_0x315d9b(0xd7)](/\*/g,'ร'),_0x470c6c=_0x470c6c[_0x315d9b(0xd7)](/\//g,'รท'),_0x470c6c;}document['getElementById'](_0x15bcb5(0xaa))['addEventListener'](_0x15bcb5(0x9e),startChat),document['getElementById'](_0x15bcb5(0xa3))[_0x15bcb5(0xdb)](_0x15bcb5(0x9e),sendMessage),document[_0x15bcb5(0xb1)](_0x15bcb5(0xec))[_0x15bcb5(0xdb)]('click',leaveChatRoom),document[_0x15bcb5(0xb1)]('chat-input')[_0x15bcb5(0xdb)]('input',handleTyping),document[_0x15bcb5(0xb1)](_0x15bcb5(0xe2))[_0x15bcb5(0xdb)](_0x15bcb5(0xed),_0x4cb85d=>{const _0x338f63=_0x15bcb5;_0x4cb85d[_0x338f63(0xca)]===_0x338f63(0xf6)&&(_0x4cb85d[_0x338f63(0xeb)](),sendMessage());}),setInterval(()=>{const _0x251c99=_0x15bcb5;document[_0x251c99(0xb1)](_0x251c99(0xd8))[_0x251c99(0xe4)]=new Date()[_0x251c99(0xb4)]();},0x3e8);